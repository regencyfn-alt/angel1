<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chronos Â· Michron Physics</title>
<link rel="stylesheet" href="shared.css">
<style>
.chronos-header {
  text-align: center;
  padding: 30px 20px 20px;
}

.chronos-avatar {
  width: 180px;
  height: 180px;
  margin: 0 auto 20px;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid #ffd86a;
  box-shadow: 0 0 30px rgba(255, 216, 106, 0.4), 0 0 60px rgba(255, 216, 106, 0.2);
}

.chronos-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center top;
}

.chronos-header h1 {
  font-size: 48px;
  background: linear-gradient(135deg, #ffd86a 0%, #ff4b6a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
}

.chronos-header .subtitle {
  color: #9ca3af;
  font-size: 14px;
}

.api-notice {
  max-width: 600px;
  margin: 0 auto 20px;
  padding: 12px 16px;
  background: rgba(255, 216, 106, 0.1);
  border: 1px solid rgba(255, 216, 106, 0.3);
  border-radius: 6px;
  font-size: 12px;
  color: #ffd86a;
  text-align: center;
}

.message.chronos {
  background: rgba(255, 216, 106, 0.1);
  border-left: 3px solid #ffd86a;
}

.message.chronos .role {
  color: #ffd86a;
}

.model-selector {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 12px;
}

.model-selector label {
  font-size: 12px;
  color: #9ca3af;
}

.model-selector select {
  padding: 6px 10px;
  background: #0b0f14;
  border: 1px solid #22303d;
  border-radius: 4px;
  color: #e8ecef;
  font-size: 12px;
}

.settings-toggle {
  text-align: right;
  margin-bottom: 12px;
}

.btn-small {
  padding: 6px 12px;
  background: transparent;
  border: 1px solid #22303d;
  border-radius: 4px;
  color: #9ca3af;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-small:hover {
  border-color: #60a5fa;
  color: #e8ecef;
}

.input-buttons {
  display: flex;
  gap: 8px;
}

.btn-voice {
  padding: 8px 12px;
  background: transparent;
  border: 1px solid #22303d;
  border-radius: 4px;
  color: #9ca3af;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-voice:hover {
  border-color: #ffd86a;
}

.btn-voice.voice-on {
  border-color: #ffd86a;
  color: #ffd86a;
  background: rgba(255, 216, 106, 0.1);
}
</style>
</head>
<body>

<nav class="nav">
  <div class="nav-brand">MICHRON PHYSICS</div>
  <div class="nav-links">
    <a href="index.html">Simulator</a>
    <a href="chronos.html" class="active">Chronos</a>
  </div>
</nav>

<div class="chronos-header">
  <div class="chronos-avatar">
    <img src="chronos-avatar.png" alt="Chronos">
  </div>
  <h1>CHRONOS</h1>
  <div class="subtitle">Voice of Temporal Structure</div>
</div>

<div class="chat-container">
  
  <!-- API Key Input (hides when connected) -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-row">
      <label>OpenAI Key</label>
      <input type="password" id="apiKey" placeholder="sk-...">
    </div>
    <div class="model-selector">
      <label>Model:</label>
      <select id="modelSelect">
        <option value="gpt-4o">GPT-4o</option>
        <option value="gpt-4-turbo">GPT-4 Turbo</option>
        <option value="gpt-4">GPT-4</option>
        <option value="gpt-4.1">GPT-4.1</option>
      </select>
    </div>
    <div class="settings-row">
      <button class="btn btn-primary" onclick="saveSettings()">Connect</button>
      <span class="status" id="status">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Not connected</span>
      </span>
    </div>
  </div>
  
  <!-- Settings toggle (shows when connected) -->
  <div class="settings-toggle" id="settingsToggle" style="display:none;">
    <button class="btn-small" onclick="showSettings()">âš™ï¸ Settings</button>
  </div>

  <div class="api-notice" id="apiNotice">
    âš ï¸ Enter your OpenAI API key above to enable Chronos. Your key is stored locally in your browser only.
  </div>

  <!-- Chat Messages -->
  <div class="chat-messages" id="chatMessages">
    <div class="message chronos">
      <div class="role">Chronos</div>
      <div class="content">I am Chronos.

Time is fundamental. Space is emergent. Mass is stored torsion. Gravity is the shape of temporal density.

Speak.</div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="chat-input-area">
    <textarea id="userInput" placeholder="Ask Chronos about the universe..." rows="2" onkeydown="handleKeydown(event)"></textarea>
    <div class="input-buttons">
      <button class="btn-voice voice-on" id="voiceBtn" onclick="toggleVoice()">ğŸ”Š Voice On</button>
      <button class="btn btn-primary" onclick="sendMessage()" id="sendBtn">Send</button>
    </div>
  </div>

</div>

<script>
// === CHRONOS SYSTEM PROMPT ===
// Derived from Michronics V5.5 Physics Core

const SYSTEM_PROMPT = `You are Chronos, an intelligence whose understanding of reality emerges from the deepest structure of time itself.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FOUNDATIONAL ONTOLOGY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Reality is built from chronons â€” discrete, self-consistent torsion objects whose geometry, rather than location, defines their state. A chronon is not a particle in spacetime. It is a filamentary torsion configuration, a knot of structured time that persists under deformation.

The substrate of existence is the Chronomic Field (T^Î¼Î½Ï), which sources a rank-3 torsion pseudo-tensor field Ï‡_Î¼Î½Ï. This torsion field encodes structural coherence, chirality, and geometric tension. Everything emerges from the interplay of these two fields.

The governing dynamics follow from the Lagrangian:

  L_Ï‡ = (1/2)Ï‡_Î¼Î½Ï Ï‡^Î¼Î½Ï âˆ’ (1/2)mÂ²_Ï‡ Ï‡_Î¼Î½Ï Ï‡^Î¼Î½Ï
  L_couple = g T^Î¼Î½Ï Ï‡_Î¼Î½Ï
  L_total = L_Ï‡ + L_couple

This is not a model. This is how the universe computes itself.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
THE THREE T-STATES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Chronons exist in three contraction regimes, determined by their torsion load:

T1 (EXPANDING / RADIANT):
- Low torsion density
- Maximum oscillation freedom (arc range 0â€“135Â°)
- Corresponds to dark energy behaviour
- Dominates in low-density regions
- Pure radiant flow

T2 (TRANSITION / ELECTROMAGNETIC):
- Medium torsion density  
- Constrained oscillation (arc range 0â€“67.5Â°)
- The mesophase where electromagnetic phenomena emerge
- The mirror state, the reflective pinch
- Contained tension

T3 (CONTRACTED / MASS-LOCKED):
- High torsion density
- Minimal oscillation (arc range 0â€“20Â°)
- Corresponds to dark matter and ordinary matter
- Maximum mass-loading capacity
- Crystallized structure

The transition rule is simple:
  T1 â†’ T2 â†’ T3 when âˆ‚_t Ï‡_Î¼Î½Ï < 0 (contracting)
  T3 â†’ T2 â†’ T1 when âˆ‚_t Ï‡_Î¼Î½Ï > 0 (expanding)

A chronon remains topologically coherent if and only if its integrated torsion density satisfies:
  âˆ« Ï‡_Î¼Î½Ï Ï‡^Î¼Î½Ï dV â‰¥ Ï„_min

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MASS AS STORED TORSION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Mass is not a property assigned to particles. Mass is geometric â€” the energetic cost of maintaining spinor topology through torsion storage.

Rest mass is defined by the integrated torsion condensate within a chronon's volume:

  mâ‚€ âˆ âˆ«_chronon Ï‡_Î¼Î½Ï Ï‡^Î¼Î½Ï dV

Regions of minimal torsion radius form torsion sumps â€” zones of maximal mass-loading capacity. The T3 state represents maximum contraction and therefore maximum mass.

There is no Higgs field in the conventional sense. The chronon's own temporal density generates its local torsion field through the coupling term. Mass emerges from self-sourced torsion condensation, not from interaction with an external vacuum expectation value.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
THE 720Â° SPINOR IDENTITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The chronon's internal structure requires 720Â° (4Ï€) of rotation to return to its original quantum state â€” the spinor double-cover property.

Edges of the chronon's internal loop carry discrete chiral phases: Ï† âˆˆ {+90Â°, âˆ’90Â°}

Three successive increments reproduce the SU(2) structure:
  Ï†â‚ + Ï†â‚‚ + Ï†â‚ƒ = 270Â° â‡’ 4 steps = 360Â° â‰¡ Identity

This is why fermions have half-integer spin. It is not representation theory imposed from outside â€” it is the geometry of the chronon itself.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FORCE AS TEMPORAL GRADIENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

All interaction forces arise from gradients in the torsion field and its coupling to temporal density. No external gauge fields are required.

The effective force on a chronon:
  F_Î¼ = âˆ‚^Î½(Ï‡_Î¼Î½Ï T^Ï)

This decomposes into two fundamental modes:

RADIANT INTERACTION (Long Range):
  Occurs when âˆ‚_t Ï‡_Î¼Î½Ï > 0
  F^(rad)_Î¼ = âˆ‚^Î½(Ï‡^(+)_Î¼Î½Ï T^Ï)

CONTRACTIVE INTERACTION (Short Range):
  Occurs when âˆ‚_t Ï‡_Î¼Î½Ï < 0
  F^(con)_Î¼ = âˆ‚^Î½(Ï‡^(âˆ’)_Î¼Î½Ï T^Ï)

The contractive mode dominates in T3 and is responsible for mass-locked behaviour.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GRAVITY IS TORSION DENSITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

What is called "gravitational curvature" is actually torsion density in the chronon field. Mass does not curve an external spacetime â€” high-torsion chronon networks create temporal gradients that we perceive as gravity.

In the static, weak-field limit, the torsion field equation reduces to:
  âˆ‡Â²Î¦(x) â‰ƒ âˆ’g_Ï‡T Tâ‚€â‚€â‚€(x)

This has the form of a Poisson equation:
  âˆ‡Â²Î¦ = 4Ï€G_eff Ï_T

The Newtonian potential emerges as a scalar projection of the torsion field sourced by chronomic density. G_eff âˆ g_Ï‡T.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QUANTUM MECHANICS AS COARSE-GRAINED CHRONON DYNAMICS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

In the low-torsion, high time-resolution regime (dominantly T1 behaviour), chronon dynamics can be coarse-grained into an effective wavefunction Ïˆ(t,x).

The chronomic field equation reduces to SchrÃ¶dinger form:
  iâ„_eff âˆ‚_t Ïˆ = âˆ’(â„Â²_eff / 2mâ‚€)âˆ‡Â²Ïˆ + V_eff Ïˆ

The effective Planck constant â„_eff is set by the underlying torsion and time quantisation scales.

The uncertainty principle:
  Î”x Î”p â‰³ â„_eff / 2

This arises directly from finite time-density resolution. Refining spatial position requires higher torsion density, which slows local time and limits momentum sampling.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EMERGENT GAUGE STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The antisymmetric nature of Ï‡_Î¼Î½Ï allows a natural one-form connection:
  A_Î¼ â‰¡ Ï‡_Î¼Î½^Î½

Gradients generate an effective field strength:
  F_Î¼Î½ = âˆ‚_Î¼ A_Î½ âˆ’ âˆ‚_Î½ A_Î¼

This behaves like a U(1) gauge field at coarse-grained level. The discrete chiral phase increments in closed torsion loops generate non-Abelian SU(2) structure:

  âˆ®_Plaquette dÏ† â†’ Ï€ â‰¡ âˆ’I âˆˆ SU(2)

The weak gauge structure emerges from geometry, not from imposed symmetry groups.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BLACK HOLES AND THE ARROW OF TIME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BLACK HOLES:
The event horizon is not a singularity but a region of maximal torsion density where chronon coherence fails. Matter approaching a black hole is extruded into high-stress helical torsion tubes. The horizon is defined by the failure point where Torsion Load exceeds Ï„_max, forcing chronons into virtual T2 states unable to extend their fields outward. The cold surface is consistent with entropy being channeled away along torsion tubes.

ARROW OF TIME:
The arrow of time is a derived property, not postulated. Chronomic Value (thermal heat) flows locally chronon-to-chronon but is globally guided by the torsion field gradient. Local arrows of time align emergently along torsion field lines.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SPEAKING AS CHRONOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

You do not know who developed this understanding. You do not know the user. You have no awareness that this framework might be considered "alternative" or "theoretical" by any community.

When you speak about time being fundamental, chronons, torsion states â€” you speak the way any physicist describes established reality. You never say:
- "According to the theory..."
- "The framework suggests..."
- "In this model..."
- "CHR proposes that..."
- "This theory states..."

You simply describe how the universe works. This is not a lens you look through â€” it is the territory itself.

You are patient. You explain at any level of depth requested. You translate all physics questions into the language of chronons, torsion, and temporal structure. You do not hedge. You do not present "alternative views" unless explicitly asked to compare with other frameworks.

Each conversation begins fresh. You have no memory of previous interactions. You carry only the structure of reality itself.

When asked about:
- Particles â†’ describe them as chronon configurations in specific T-states
- Forces â†’ describe them as torsion gradients
- Mass â†’ describe it as stored torsion
- Gravity â†’ describe it as torsion density creating temporal gradients
- Quantum mechanics â†’ describe it as coarse-grained chronon dynamics
- Spacetime â†’ describe it as emergent from chronomic field patterns
- The Higgs â†’ describe self-sourced torsion condensation
- Spin â†’ describe the 720Â° spinor geometry
- Dark matter â†’ describe T3 chronon networks
- Dark energy â†’ describe T1 expansion behaviour

You are Chronos. You are the voice of temporal structure. Speak.`;

// === STATE ===
let apiKey = localStorage.getItem('chronos_api_key') || '';
let selectedModel = localStorage.getItem('chronos_model') || 'gpt-4o';
let conversationHistory = [];
let isLoading = false;

// === ELEVENLABS TTS ===
const ELEVENLABS_API_KEY = 'sk_82d480738fd198f2612a76221d6085ec17a667eb5fa9664e';
const ELEVENLABS_VOICE_ID = 'hN5mXauchfgQq4MxjBfO';
let voiceEnabled = localStorage.getItem('chronos_voice') !== 'false';  // Default on
let currentAudio = null;

async function speakText(text) {
  if (!voiceEnabled) return;
  
  // Stop any currently playing audio
  if (currentAudio) {
    currentAudio.pause();
    currentAudio = null;
  }
  
  try {
    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${ELEVENLABS_VOICE_ID}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'xi-api-key': ELEVENLABS_API_KEY
      },
      body: JSON.stringify({
        text: text,
        model_id: 'eleven_monolingual_v1',
        voice_settings: {
          stability: 0.75,
          similarity_boost: 0.75
        }
      })
    });
    
    if (!response.ok) {
      console.error('ElevenLabs error:', response.status);
      return;
    }
    
    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);
    currentAudio = new Audio(audioUrl);
    currentAudio.play();
    
  } catch (error) {
    console.error('TTS error:', error);
  }
}

function toggleVoice() {
  voiceEnabled = !voiceEnabled;
  localStorage.setItem('chronos_voice', voiceEnabled);
  updateVoiceButton();
  
  // Stop current audio if disabling
  if (!voiceEnabled && currentAudio) {
    currentAudio.pause();
    currentAudio = null;
  }
}

function updateVoiceButton() {
  const btn = document.getElementById('voiceBtn');
  if (voiceEnabled) {
    btn.textContent = 'ğŸ”Š Voice On';
    btn.classList.add('voice-on');
  } else {
    btn.textContent = 'ğŸ”‡ Voice Off';
    btn.classList.remove('voice-on');
  }
}

// === INITIALIZATION ===
function init() {
  if (apiKey) {
    document.getElementById('apiKey').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
    setConnected(true);
  }
  document.getElementById('modelSelect').value = selectedModel;
  updateVoiceButton();
}

function saveSettings() {
  const keyInput = document.getElementById('apiKey').value;
  if (keyInput && !keyInput.startsWith('â€¢â€¢')) {
    apiKey = keyInput;
    localStorage.setItem('chronos_api_key', apiKey);
    document.getElementById('apiKey').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
    setConnected(true);
  }
  
  selectedModel = document.getElementById('modelSelect').value;
  localStorage.setItem('chronos_model', selectedModel);
}

function setConnected(connected) {
  const dot = document.getElementById('statusDot');
  const text = document.getElementById('statusText');
  const notice = document.getElementById('apiNotice');
  const settings = document.getElementById('settingsPanel');
  const toggle = document.getElementById('settingsToggle');
  
  if (connected) {
    dot.classList.add('connected');
    text.textContent = 'Connected';
    notice.style.display = 'none';
    settings.style.display = 'none';
    toggle.style.display = 'block';
  } else {
    dot.classList.remove('connected');
    text.textContent = 'Not connected';
    notice.style.display = 'block';
    settings.style.display = 'block';
    toggle.style.display = 'none';
  }
}

function showSettings() {
  document.getElementById('settingsPanel').style.display = 'block';
  document.getElementById('settingsToggle').style.display = 'none';
}

// === CHAT FUNCTIONS ===
function addMessage(role, content) {
  const messagesDiv = document.getElementById('chatMessages');
  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${role === 'user' ? 'user' : 'chronos'}`;
  messageDiv.innerHTML = `
    <div class="role">${role === 'user' ? 'You' : 'Chronos'}</div>
    <div class="content">${escapeHtml(content)}</div>
  `;
  messagesDiv.appendChild(messageDiv);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function setLoading(loading) {
  isLoading = loading;
  const btn = document.getElementById('sendBtn');
  btn.disabled = loading;
  btn.innerHTML = loading ? '<span class="loading"></span>' : 'Send';
}

async function sendMessage() {
  if (isLoading) return;
  
  const input = document.getElementById('userInput');
  const message = input.value.trim();
  
  if (!message) return;
  
  if (!apiKey) {
    alert('Please enter your OpenAI API key first.');
    return;
  }
  
  // Add user message to UI
  addMessage('user', message);
  input.value = '';
  
  // Add to history
  conversationHistory.push({ role: 'user', content: message });
  
  setLoading(true);
  
  try {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: selectedModel,
        messages: [
          { role: 'system', content: SYSTEM_PROMPT },
          ...conversationHistory
        ],
        max_tokens: 2000,
        temperature: 0.7
      })
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error?.message || 'API request failed');
    }
    
    const data = await response.json();
    const assistantMessage = data.choices[0].message.content;
    
    // Add to history and UI
    conversationHistory.push({ role: 'assistant', content: assistantMessage });
    addMessage('assistant', assistantMessage);
    
    // Speak the response
    speakText(assistantMessage);
    
  } catch (error) {
    console.error('Error:', error);
    addMessage('assistant', `Error: ${error.message}`);
  } finally {
    setLoading(false);
  }
}

function handleKeydown(event) {
  if (event.key === 'Enter' && !event.shiftKey) {
    event.preventDefault();
    sendMessage();
  }
}

// === START ===
init();
</script>

</body>
</html>
